<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Calculate Spatial Metrics | Intro to R-Spatial for Healthy Places</title>
  <meta name="description" content="This was developed by the Healthy Regions - Policies Lab." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Calculate Spatial Metrics | Intro to R-Spatial for Healthy Places" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This was developed by the Healthy Regions - Policies Lab." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Calculate Spatial Metrics | Intro to R-Spatial for Healthy Places" />
  
  <meta name="twitter:description" content="This was developed by the Healthy Regions - Policies Lab." />
  



<meta name="date" content="2023-06-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="03-overlaypoints.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.1.2/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script>



<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Background</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#environment-setup"><i class="fa fa-check"></i>Environment Setup</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="01-intro.html"><a href="01-intro.html"><i class="fa fa-check"></i><b>1</b> Intro to Spatial Data</a>
<ul>
<li class="chapter" data-level="1.1" data-path="01-intro.html"><a href="01-intro.html#load-spatial-data"><i class="fa fa-check"></i><b>1.1</b> Load Spatial Data</a></li>
<li class="chapter" data-level="1.2" data-path="01-intro.html"><a href="01-intro.html#non-spatial-spatial-views"><i class="fa fa-check"></i><b>1.2</b> Non-Spatial &amp; Spatial Views</a></li>
<li class="chapter" data-level="1.3" data-path="01-intro.html"><a href="01-intro.html#spatial-data-structure"><i class="fa fa-check"></i><b>1.3</b> Spatial Data Structure</a></li>
<li class="chapter" data-level="1.4" data-path="01-intro.html"><a href="01-intro.html#exploring-coordinate-reference-systems"><i class="fa fa-check"></i><b>1.4</b> Exploring Coordinate Reference Systems</a></li>
<li class="chapter" data-level="1.5" data-path="01-intro.html"><a href="01-intro.html#refine-basic-map"><i class="fa fa-check"></i><b>1.5</b> Refine Basic Map</a></li>
<li class="chapter" data-level="1.6" data-path="01-intro.html"><a href="01-intro.html#arrange-multiple-maps"><i class="fa fa-check"></i><b>1.6</b> Arrange multiple maps</a></li>
<li class="chapter" data-level="1.7" data-path="01-intro.html"><a href="01-intro.html#interactive-mode"><i class="fa fa-check"></i><b>1.7</b> Interactive Mode</a></li>
<li class="chapter" data-level="1.8" data-path="01-intro.html"><a href="01-intro.html#overlay-zip-code-boundaries"><i class="fa fa-check"></i><b>1.8</b> Overlay Zip Code Boundaries</a></li>
<li class="chapter" data-level="" data-path="01-intro.html"><a href="01-intro.html#more-resources"><i class="fa fa-check"></i>More Resources</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="02-choropleth.html"><a href="02-choropleth.html"><i class="fa fa-check"></i><b>2</b> Map Neighborhoods</a>
<ul>
<li class="chapter" data-level="2.1" data-path="02-choropleth.html"><a href="02-choropleth.html#clean-attribute-data"><i class="fa fa-check"></i><b>2.1</b> Clean Attribute Data</a></li>
<li class="chapter" data-level="2.2" data-path="02-choropleth.html"><a href="02-choropleth.html#merge-spatial-data"><i class="fa fa-check"></i><b>2.2</b> Merge Spatial Data</a></li>
<li class="chapter" data-level="2.3" data-path="02-choropleth.html"><a href="02-choropleth.html#quantile-maps"><i class="fa fa-check"></i><b>2.3</b> Quantile Maps</a></li>
<li class="chapter" data-level="2.4" data-path="02-choropleth.html"><a href="02-choropleth.html#standard-deviation-maps"><i class="fa fa-check"></i><b>2.4</b> Standard Deviation Maps</a></li>
<li class="chapter" data-level="2.5" data-path="02-choropleth.html"><a href="02-choropleth.html#jenks-maps"><i class="fa fa-check"></i><b>2.5</b> Jenks Maps</a></li>
<li class="chapter" data-level="2.6" data-path="02-choropleth.html"><a href="02-choropleth.html#integrate-more-data"><i class="fa fa-check"></i><b>2.6</b> Integrate More Data</a></li>
<li class="chapter" data-level="2.7" data-path="02-choropleth.html"><a href="02-choropleth.html#thematic-map-panel"><i class="fa fa-check"></i><b>2.7</b> Thematic Map Panel</a></li>
<li class="chapter" data-level="2.8" data-path="02-choropleth.html"><a href="02-choropleth.html#data"><i class="fa fa-check"></i><b>2.8</b> Data</a></li>
<li class="chapter" data-level="" data-path="02-choropleth.html"><a href="02-choropleth.html#more-resources-1"><i class="fa fa-check"></i>More Resources</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="05-LISA.html"><a href="05-LISA.html"><i class="fa fa-check"></i><b>3</b> Spatial Cluster Detection</a>
<ul>
<li class="chapter" data-level="3.1" data-path="05-LISA.html"><a href="05-LISA.html#identify-pattern"><i class="fa fa-check"></i><b>3.1</b> Identify Pattern</a></li>
<li class="chapter" data-level="3.2" data-path="05-LISA.html"><a href="05-LISA.html#load-rgeoda"><i class="fa fa-check"></i><b>3.2</b> Load rGeoda</a></li>
<li class="chapter" data-level="3.3" data-path="05-LISA.html"><a href="05-LISA.html#define-w"><i class="fa fa-check"></i><b>3.3</b> Define W</a></li>
<li class="chapter" data-level="3.4" data-path="05-LISA.html"><a href="05-LISA.html#calculate-lisa"><i class="fa fa-check"></i><b>3.4</b> Calculate LISA</a></li>
<li class="chapter" data-level="3.5" data-path="05-LISA.html"><a href="05-LISA.html#map-the-lisa"><i class="fa fa-check"></i><b>3.5</b> Map the LISA</a></li>
<li class="chapter" data-level="" data-path="05-LISA.html"><a href="05-LISA.html#more-resources-2"><i class="fa fa-check"></i>More Resources</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="03-overlaypoints.html"><a href="03-overlaypoints.html"><i class="fa fa-check"></i><b>4</b> Adding Resources</a>
<ul>
<li class="chapter" data-level="4.1" data-path="03-overlaypoints.html"><a href="03-overlaypoints.html#geocode"><i class="fa fa-check"></i><b>4.1</b> Geocode</a></li>
<li class="chapter" data-level="4.2" data-path="03-overlaypoints.html"><a href="03-overlaypoints.html#convert-to-spatial-data"><i class="fa fa-check"></i><b>4.2</b> Convert to Spatial Data</a></li>
<li class="chapter" data-level="4.3" data-path="03-overlaypoints.html"><a href="03-overlaypoints.html#basic-map-of-points"><i class="fa fa-check"></i><b>4.3</b> Basic Map of Points</a></li>
<li class="chapter" data-level="4.4" data-path="03-overlaypoints.html"><a href="03-overlaypoints.html#overlay-points-style"><i class="fa fa-check"></i><b>4.4</b> Overlay Points &amp; Style</a></li>
<li class="chapter" data-level="4.5" data-path="03-overlaypoints.html"><a href="03-overlaypoints.html#integrate-more-data-1"><i class="fa fa-check"></i><b>4.5</b> Integrate More Data</a></li>
<li class="chapter" data-level="4.6" data-path="03-overlaypoints.html"><a href="03-overlaypoints.html#graduated-symbology"><i class="fa fa-check"></i><b>4.6</b> Graduated Symbology</a></li>
<li class="chapter" data-level="4.7" data-path="03-overlaypoints.html"><a href="03-overlaypoints.html#style-final-map"><i class="fa fa-check"></i><b>4.7</b> Style Final Map</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="04-newsvar.html"><a href="04-newsvar.html"><i class="fa fa-check"></i><b>5</b> Calculate Spatial Metrics</a>
<ul>
<li class="chapter" data-level="5.1" data-path="04-newsvar.html"><a href="04-newsvar.html#load-spatial-data-1"><i class="fa fa-check"></i><b>5.1</b> Load Spatial Data</a></li>
<li class="chapter" data-level="5.2" data-path="04-newsvar.html"><a href="04-newsvar.html#transform-projections"><i class="fa fa-check"></i><b>5.2</b> Transform Projections</a></li>
<li class="chapter" data-level="5.3" data-path="04-newsvar.html"><a href="04-newsvar.html#count-resources-by-area"><i class="fa fa-check"></i><b>5.3</b> Count resources by area</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="04-newsvar.html"><a href="04-newsvar.html#count-per-area"><i class="fa fa-check"></i><b>5.3.1</b> Count # per Area</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="04-newsvar.html"><a href="04-newsvar.html#buffer-data"><i class="fa fa-check"></i><b>5.4</b> Buffer Data</a></li>
<li class="chapter" data-level="5.5" data-path="04-newsvar.html"><a href="04-newsvar.html#count-buffers-by-area"><i class="fa fa-check"></i><b>5.5</b> Count buffers by area</a></li>
<li class="chapter" data-level="5.6" data-path="04-newsvar.html"><a href="04-newsvar.html#integrate-explore"><i class="fa fa-check"></i><b>5.6</b> Integrate &amp; Explore</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Intro to R-Spatial for Healthy Places</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="calculate-spatial-metrics" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">5</span> Calculate Spatial Metrics<a href="04-newsvar.html#calculate-spatial-metrics" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>While we’ve generated some nice visualizations, we need insights quantified as metrics at the neighborhood level. Don’t start this step until you have a good idea of what you need. Visualizing and exploring the data in depth is best practice.</p>
<p>For our purposes, we’re interested in developing spatial access metrics with a container method approach. At the end of this tutorial, we’ll generate the following new variables:</p>
<ul>
<li>Total number of Methadone Maintenance MOUD by zip code</li>
<li>Total number of Walkble MOUD Service Areas by zip code</li>
</ul>
<p>Plus, we will have a new spatial layer, that includes the actual service areas (ie. 1-mile buffers of MOUDs). We assume that access to MOUDs is critical and requires high regularity, and that walking is the most likely option during COVID. This guides the parameter specification of MOUD Service Areas (and is also backed up by some literature in this space, though much more is needed.)</p>
<div id="load-spatial-data-1" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> Load Spatial Data<a href="04-newsvar.html#load-spatial-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s first reload our spatial data – this will be the MOUD points, plus the master zip code spatial file.</p>
<pre class="r"><code>#library(sf)
#library(tmap)

points &lt;- st_read(&quot;data/methadoneMOUD.geojson&quot;)</code></pre>
<pre><code>## Reading layer `methadoneMOUD&#39; from data source 
##   `/Users/maryniakolak/Code/Intro2RSpatialMed/data/methadoneMOUD.geojson&#39; using driver `GeoJSON&#39;
## Simple feature collection with 25 features and 8 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -87.7349 ymin: 41.68698 xmax: -87.57673 ymax: 41.9533
## Geodetic CRS:  WGS 84</code></pre>
<pre class="r"><code>areas &lt;- st_read(&quot;data/geo_export_54bc15d8-5ef5-40e4-8f72-bb0c6dbac9a5.shp&quot;)</code></pre>
<pre><code>## Reading layer `geo_export_54bc15d8-5ef5-40e4-8f72-bb0c6dbac9a5&#39; from data source 
##   `/Users/maryniakolak/Code/Intro2RSpatialMed/data/geo_export_54bc15d8-5ef5-40e4-8f72-bb0c6dbac9a5.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 61 features and 4 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -87.94011 ymin: 41.64454 xmax: -87.52414 ymax: 42.02304
## Geodetic CRS:  WGS84(DD)</code></pre>
<pre class="r"><code>dim(points)</code></pre>
<pre><code>## [1] 25  9</code></pre>
<pre class="r"><code>dim(areas)</code></pre>
<pre><code>## [1] 61  5</code></pre>
<pre class="r"><code>head(points)</code></pre>
<pre><code>## Simple feature collection with 6 features and 8 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -87.72186 ymin: 41.88474 xmax: -87.63409 ymax: 41.9533
## Geodetic CRS:  WGS 84
##   X                                                         Name              Address    City
## 1 3 Soft Landing Interventions/DBA Symetria Recovery of Lakeview 3934 N. Lincoln Ave. Chicago
## 2 4                                        PDSSC - Chicago, Inc.  2260 N. Elston Ave. Chicago
## 3 5                          Center for Addictive Problems, Inc.     609 N. Wells St. Chicago
## 4 6                                Family Guidance Centers, Inc.  310 W. Chicago Ave. Chicago
## 5 7                                     A Rincon Family Services   3809 W. Grand Ave. Chicago
## 6 8                                                            *  140 N. Ashland Ave. Chicago
##   State   Zip                               fullAdd geo_method                   geometry
## 1    IL 60613 3934 N. Lincoln Ave. Chicago IL 60613     census  POINT (-87.67818 41.9533)
## 2    IL 60614  2260 N. Elston Ave. Chicago IL 60614     census POINT (-87.67407 41.92269)
## 3    IL 60654     609 N. Wells St. Chicago IL 60654     census POINT (-87.63409 41.89268)
## 4    IL 60654  310 W. Chicago Ave. Chicago IL 60654     census POINT (-87.63636 41.89657)
## 5    IL 60651   3809 W. Grand Ave. Chicago IL 60651     census POINT (-87.72186 41.90435)
## 6    IL 60607  140 N. Ashland Ave. Chicago IL 60607        osm POINT (-87.66725 41.88474)</code></pre>
<pre class="r"><code>head(areas)</code></pre>
<pre><code>## Simple feature collection with 6 features and 4 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -87.80649 ymin: 41.88747 xmax: -87.59852 ymax: 41.93228
## Geodetic CRS:  WGS84(DD)
##   objectid shape_area shape_len   zip                       geometry
## 1       33  106052287  42720.04 60647 MULTIPOLYGON (((-87.67762 4...
## 2       34  127476051  48103.78 60639 MULTIPOLYGON (((-87.72683 4...
## 3       35   45069038  27288.61 60707 MULTIPOLYGON (((-87.785 41....
## 4       36   70853834  42527.99 60622 MULTIPOLYGON (((-87.66707 4...
## 5       37   99039621  47970.14 60651 MULTIPOLYGON (((-87.70656 4...
## 6       38   23506056  34689.35 60611 MULTIPOLYGON (((-87.61401 4...</code></pre>
</div>
<div id="transform-projections" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> Transform Projections<a href="04-newsvar.html#transform-projections" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>First we need to switch to a projection that uses distance in feet or meters as a metric. We’ll use EPSG:3435 from the first tutorial. To find which EPSG was recommended, I searched “EPSG Illinois feet” and EPSG:3435 came up as a viable candidate. So, we use that for our new, projected CRS.</p>
<pre class="r"><code>areas &lt;- st_transform(areas, 3435)
points &lt;- st_transform(points, 3435)</code></pre>
<p>We may want to once again confirm they are plotting correctly:</p>
<pre class="r"><code>tm_shape(areas) + tm_polygons() +
  tm_shape(points) + tm_dots(size = 1)</code></pre>
<p><img src="Spatial-R-for-Healthy-Places_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
</div>
<div id="count-resources-by-area" class="section level2 hasAnchor" number="5.3">
<h2><span class="header-section-number">5.3</span> Count resources by area<a href="04-newsvar.html#count-resources-by-area" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>One way of understanding resource inequity is by thinking about how many resources exist in a neighborhood.</p>
<p>First, give the points the attributes of the polygons they are in. Inspect.</p>
<pre class="r"><code>pipr &lt;- st_join(points, areas)
head(pipr)</code></pre>
<pre><code>## Simple feature collection with 6 features and 12 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: 1150707 ymin: 1901294 xmax: 1174632 ymax: 1926255
## Projected CRS: NAD83 / Illinois East (ftUS)
##   X                                                         Name              Address    City
## 1 3 Soft Landing Interventions/DBA Symetria Recovery of Lakeview 3934 N. Lincoln Ave. Chicago
## 2 4                                        PDSSC - Chicago, Inc.  2260 N. Elston Ave. Chicago
## 3 5                          Center for Addictive Problems, Inc.     609 N. Wells St. Chicago
## 4 6                                Family Guidance Centers, Inc.  310 W. Chicago Ave. Chicago
## 5 7                                     A Rincon Family Services   3809 W. Grand Ave. Chicago
## 6 8                                                            *  140 N. Ashland Ave. Chicago
##   State   Zip                               fullAdd geo_method objectid shape_area shape_len   zip
## 1    IL 60613 3934 N. Lincoln Ave. Chicago IL 60613     census       53   53990895  31196.32 60613
## 2    IL 60614  2260 N. Elston Ave. Chicago IL 60614     census       32   94460632  50587.35 60614
## 3    IL 60654     609 N. Wells St. Chicago IL 60654     census       55   15869961  17119.70 60654
## 4    IL 60654  310 W. Chicago Ave. Chicago IL 60654     census       54   31598157  24208.70 60610
## 5    IL 60651   3809 W. Grand Ave. Chicago IL 60651     census       37   99039621  47970.14 60651
## 6    IL 60607  140 N. Ashland Ave. Chicago IL 60607        osm       16  106718949  42663.20 60612
##                  geometry
## 1 POINT (1162460 1926255)
## 2 POINT (1163663 1915110)
## 3 POINT (1174632 1904257)
## 4 POINT (1174003 1905671)
## 5 POINT (1150707 1908328)
## 6 POINT (1165627 1901294)</code></pre>
<p>You should have the same number of rows in <code>pipr</code> as you do in <code>points</code>. If not, there is something off. You may need to go back to troubleshoot. In an earlier version of this lab, I used a saved, written <code>geojson</code> file of the zip codes, and it would not render properly. Here, we load in the original shapefile at the beginning of the tutorial to avoid that error.</p>
<pre class="r"><code>dim(pipr)</code></pre>
<pre><code>## [1] 25 13</code></pre>
<pre class="r"><code>dim(points)</code></pre>
<pre><code>## [1] 25  9</code></pre>
<pre class="r"><code>dim(areas)</code></pre>
<pre><code>## [1] 61  5</code></pre>
<div id="count-per-area" class="section level3 hasAnchor" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Count # per Area<a href="04-newsvar.html#count-per-area" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Next, count the number per area. The frequency should be logical according to the map you made earlier. Sometimes, I’ve found bugs where the numbers are multipled by some factor; this can be checked by looking at dimension disparities, as noted above.</p>
<pre class="r"><code>ptcount &lt;- as.data.frame(table(pipr$Zip))
head(ptcount)</code></pre>
<pre><code>##    Var1 Freq
## 1 60607    2
## 2 60608    1
## 3 60609    1
## 4 60613    1
## 5 60614    1
## 6 60615    1</code></pre>
<p>How could improve on this step if you used <code>dplyr</code>?</p>
<p><strong>Aggregation Tip:</strong> What if you have an attribute value you’d like to aggregate? For example, average units of affordable housing facility by zip?
Try <code>aggregate(pip$attribute, by = list(pip$geoid), mean)</code> but build on with a tidy sensibility…</p>
<p>Now we can rename our attributes:</p>
<pre class="r"><code>names(ptcount) &lt;- c(&quot;zip&quot;, &quot;MetClnc&quot;)
head(ptcount)</code></pre>
<pre><code>##     zip MetClnc
## 1 60607       2
## 2 60608       1
## 3 60609       1
## 4 60613       1
## 5 60614       1
## 6 60615       1</code></pre>
<p>And finally, merge back to your master zip file:</p>
<pre class="r"><code>head(areas)</code></pre>
<pre><code>## Simple feature collection with 6 features and 4 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 1127607 ymin: 1902374 xmax: 1184320 ymax: 1918596
## Projected CRS: NAD83 / Illinois East (ftUS)
##   objectid shape_area shape_len   zip                       geometry
## 1       33  106052287  42720.04 60647 MULTIPOLYGON (((1162711 191...
## 2       34  127476051  48103.78 60639 MULTIPOLYGON (((1149304 191...
## 3       35   45069038  27288.61 60707 MULTIPOLYGON (((1133505 190...
## 4       36   70853834  42527.99 60622 MULTIPOLYGON (((1165664 190...
## 5       37   99039621  47970.14 60651 MULTIPOLYGON (((1154895 190...
## 6       38   23506056  34689.35 60611 MULTIPOLYGON (((1180097 190...</code></pre>
<pre class="r"><code>areas&lt;- merge(areas, ptcount, by=&quot;zip&quot;, all = TRUE)
head(areas)</code></pre>
<pre><code>## Simple feature collection with 6 features and 5 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 1173038 ymin: 1889918 xmax: 1183259 ymax: 1902959
## Projected CRS: NAD83 / Illinois East (ftUS)
##     zip objectid shape_area shape_len MetClnc                       geometry
## 1 60601       27    9166246  19804.58      NA MULTIPOLYGON (((1177742 190...
## 2 60602       26    4847125  14448.17      NA MULTIPOLYGON (((1181226 190...
## 3 60603       19    4560229  13672.68      NA MULTIPOLYGON (((1179499 190...
## 4 60604       48    4294902  12245.81      NA MULTIPOLYGON (((1174763 189...
## 5 60605       20   36301276  37973.35      NA MULTIPOLYGON (((1178341 189...
## 6 60606       31    6766411  12040.44      NA MULTIPOLYGON (((1174681 190...</code></pre>
<p>Quickly map to inspect:</p>
<pre class="r"><code>tm_shape(areas) + tm_polygons(col = &quot;gray80&quot;) +
tm_shape(areas) + tm_polygons(col = &quot;MetClnc&quot;, style = &quot;pretty&quot;, alpha = 0.8) +   
  tm_shape(points) + tm_dots(size = 0.5) </code></pre>
<p><img src="Spatial-R-for-Healthy-Places_files/figure-html/unnamed-chunk-67-1.png" width="672" /></p>
</div>
</div>
<div id="buffer-data" class="section level2 hasAnchor" number="5.4">
<h2><span class="header-section-number">5.4</span> Buffer Data<a href="04-newsvar.html#buffer-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Next, lets create a walkable buffer of one mile, or 5280 feet, for our MOUD provider locations. Individuals residing in places outside of that walkable area may have difficulty accessing this medication during crises, like a pandemic.</p>
<pre class="r"><code># Create 1mile buffers for each point
ptbuffers &lt;- st_buffer(points, 5280)
head(ptbuffers)</code></pre>
<pre><code>## Simple feature collection with 6 features and 8 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 1145427 ymin: 1896014 xmax: 1179912 ymax: 1931535
## Projected CRS: NAD83 / Illinois East (ftUS)
##   X                                                         Name              Address    City
## 1 3 Soft Landing Interventions/DBA Symetria Recovery of Lakeview 3934 N. Lincoln Ave. Chicago
## 2 4                                        PDSSC - Chicago, Inc.  2260 N. Elston Ave. Chicago
## 3 5                          Center for Addictive Problems, Inc.     609 N. Wells St. Chicago
## 4 6                                Family Guidance Centers, Inc.  310 W. Chicago Ave. Chicago
## 5 7                                     A Rincon Family Services   3809 W. Grand Ave. Chicago
## 6 8                                                            *  140 N. Ashland Ave. Chicago
##   State   Zip                               fullAdd geo_method                       geometry
## 1    IL 60613 3934 N. Lincoln Ave. Chicago IL 60613     census POLYGON ((1167740 1926255, ...
## 2    IL 60614  2260 N. Elston Ave. Chicago IL 60614     census POLYGON ((1168943 1915110, ...
## 3    IL 60654     609 N. Wells St. Chicago IL 60654     census POLYGON ((1179912 1904257, ...
## 4    IL 60654  310 W. Chicago Ave. Chicago IL 60654     census POLYGON ((1179283 1905671, ...
## 5    IL 60651   3809 W. Grand Ave. Chicago IL 60651     census POLYGON ((1155987 1908328, ...
## 6    IL 60607  140 N. Ashland Ave. Chicago IL 60607        osm POLYGON ((1170907 1901294, ...</code></pre>
<p>Inspect immediately:</p>
<pre class="r"><code>tm_shape(areas) + tm_borders() +
  tm_shape(ptbuffers) + tm_borders(col = &quot;blue&quot;) </code></pre>
<p><img src="Spatial-R-for-Healthy-Places_files/figure-html/unnamed-chunk-69-1.png" width="672" /></p>
</div>
<div id="count-buffers-by-area" class="section level2 hasAnchor" number="5.5">
<h2><span class="header-section-number">5.5</span> Count buffers by area<a href="04-newsvar.html#count-buffers-by-area" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We know that MOUD locations are accessible up to one mile away. So, a total count of resources by area may be too restrictive. Let’s calculate how many <em>walkable</em> MOUD clinics are in each zip code. Or, how many buffers are in each area…</p>
<pre class="r"><code>bufferct &lt;- lengths(st_intersects(areas, ptbuffers))
head(bufferct)</code></pre>
<pre><code>## [1] 2 2 1 1 1 2</code></pre>
<p>Stick buffer totals back to the zip master file:</p>
<pre class="r"><code># Stick buffer totals back to the census master file
areas &lt;- cbind(areas,bufferct)
head(areas)</code></pre>
<pre><code>## Simple feature collection with 6 features and 6 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 1173038 ymin: 1889918 xmax: 1183259 ymax: 1902959
## Projected CRS: NAD83 / Illinois East (ftUS)
##     zip objectid shape_area shape_len MetClnc bufferct                       geometry
## 1 60601       27    9166246  19804.58      NA        2 MULTIPOLYGON (((1177742 190...
## 2 60602       26    4847125  14448.17      NA        2 MULTIPOLYGON (((1181226 190...
## 3 60603       19    4560229  13672.68      NA        1 MULTIPOLYGON (((1179499 190...
## 4 60604       48    4294902  12245.81      NA        1 MULTIPOLYGON (((1174763 189...
## 5 60605       20   36301276  37973.35      NA        1 MULTIPOLYGON (((1178341 189...
## 6 60606       31    6766411  12040.44      NA        2 MULTIPOLYGON (((1174681 190...</code></pre>
<p>Map density of buffers per census area:</p>
<pre class="r"><code>tm_shape(areas) + tm_polygons(col = &quot;bufferct&quot;, palette = &quot;BuGn&quot;, n=5, style = &quot;jenks&quot;) + 
    tm_shape(ptbuffers) + tm_fill(col = &quot;gray90&quot;, alpha=0.6) +
    tm_shape(points) + tm_dots(col = &quot;gray10&quot;, size = 0.3) </code></pre>
<p><img src="Spatial-R-for-Healthy-Places_files/figure-html/unnamed-chunk-72-1.png" width="672" /></p>
</div>
<div id="integrate-explore" class="section level2 hasAnchor" number="5.6">
<h2><span class="header-section-number">5.6</span> Integrate &amp; Explore<a href="04-newsvar.html#integrate-explore" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s review: our master area file now has total number resources by zip and total number of walkable service areas by zip.</p>
<p>Using your new spatial file, see if you can answer some of these quetions using various queries:</p>
<ul>
<li><p>Which zip codes have high rates of COVID and are not within a walking distance of a methadone MOUD?</p></li>
<li><p>Which zip codes have worse access to affordable rental units, low educational rates, and less walkable access to MOUDs?</p></li>
<li><p>What is the demographic and racial/ethnic characteristics of areas most vulnerable to high COVID rates in September 2020?</p></li>
</ul>
<p>Generate different maps and outputs to drive your thinking and defend your hypothesis formation.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="03-overlaypoints.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
