<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Calculate Spatial Metrics | Intro to R-Spatial for Healthy Places</title>
  <meta name="description" content="This was developed for a workshop at the 2021 R-Medicine Conference by the Health Regions &amp; Policies Lab at the University of Chicago ." />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Calculate Spatial Metrics | Intro to R-Spatial for Healthy Places" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This was developed for a workshop at the 2021 R-Medicine Conference by the Health Regions &amp; Policies Lab at the University of Chicago ." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Calculate Spatial Metrics | Intro to R-Spatial for Healthy Places" />
  
  <meta name="twitter:description" content="This was developed for a workshop at the 2021 R-Medicine Conference by the Health Regions &amp; Policies Lab at the University of Chicago ." />
  

<meta name="author" content="Marynia Kolak" />


<meta name="date" content="2021-08-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="03-overlaypoints.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Background</a></li>
<li class="chapter" data-level="1" data-path="01-intro.html"><a href="01-intro.html"><i class="fa fa-check"></i><b>1</b> Intro to Spatial Data</a><ul>
<li class="chapter" data-level="1.1" data-path="01-intro.html"><a href="01-intro.html#load-spatial-data"><i class="fa fa-check"></i><b>1.1</b> Load Spatial Data</a></li>
<li class="chapter" data-level="1.2" data-path="01-intro.html"><a href="01-intro.html#non-spatial-spatial-views"><i class="fa fa-check"></i><b>1.2</b> Non-Spatial &amp; Spatial Views</a></li>
<li class="chapter" data-level="1.3" data-path="01-intro.html"><a href="01-intro.html#spatial-data-structure"><i class="fa fa-check"></i><b>1.3</b> Spatial Data Structure</a></li>
<li class="chapter" data-level="1.4" data-path="01-intro.html"><a href="01-intro.html#exploring-coordinate-reference-systems"><i class="fa fa-check"></i><b>1.4</b> Exploring Coordinate Reference Systems</a></li>
<li class="chapter" data-level="1.5" data-path="01-intro.html"><a href="01-intro.html#refine-basic-map"><i class="fa fa-check"></i><b>1.5</b> Refine Basic Map</a></li>
<li class="chapter" data-level="1.6" data-path="01-intro.html"><a href="01-intro.html#arrange-multiple-maps"><i class="fa fa-check"></i><b>1.6</b> Arrange multiple maps</a></li>
<li class="chapter" data-level="1.7" data-path="01-intro.html"><a href="01-intro.html#interactive-mode"><i class="fa fa-check"></i><b>1.7</b> Interactive Mode</a></li>
<li class="chapter" data-level="1.8" data-path="01-intro.html"><a href="01-intro.html#overlay-zip-code-boundaries"><i class="fa fa-check"></i><b>1.8</b> Overlay Zip Code Boundaries</a></li>
<li class="chapter" data-level="" data-path="01-intro.html"><a href="01-intro.html#more-resources"><i class="fa fa-check"></i>More Resources</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="02-choropleth.html"><a href="02-choropleth.html"><i class="fa fa-check"></i><b>2</b> Map Neighborhoods</a><ul>
<li class="chapter" data-level="2.1" data-path="02-choropleth.html"><a href="02-choropleth.html#clean-attribute-data"><i class="fa fa-check"></i><b>2.1</b> Clean Attribute Data</a></li>
<li class="chapter" data-level="2.2" data-path="02-choropleth.html"><a href="02-choropleth.html#merge-spatial-data"><i class="fa fa-check"></i><b>2.2</b> Merge Spatial Data</a></li>
<li class="chapter" data-level="2.3" data-path="02-choropleth.html"><a href="02-choropleth.html#quantile-maps"><i class="fa fa-check"></i><b>2.3</b> Quantile Maps</a></li>
<li class="chapter" data-level="2.4" data-path="02-choropleth.html"><a href="02-choropleth.html#standard-deviation-maps"><i class="fa fa-check"></i><b>2.4</b> Standard Deviation Maps</a></li>
<li class="chapter" data-level="2.5" data-path="02-choropleth.html"><a href="02-choropleth.html#jenks-maps"><i class="fa fa-check"></i><b>2.5</b> Jenks Maps</a></li>
<li class="chapter" data-level="2.6" data-path="02-choropleth.html"><a href="02-choropleth.html#integrate-more-data"><i class="fa fa-check"></i><b>2.6</b> Integrate More Data</a></li>
<li class="chapter" data-level="2.7" data-path="02-choropleth.html"><a href="02-choropleth.html#thematic-map-panel"><i class="fa fa-check"></i><b>2.7</b> Thematic Map Panel</a></li>
<li class="chapter" data-level="2.8" data-path="02-choropleth.html"><a href="02-choropleth.html#write-data"><i class="fa fa-check"></i><b>2.8</b> Write Data</a></li>
<li class="chapter" data-level="" data-path="02-choropleth.html"><a href="02-choropleth.html#more-resources-1"><i class="fa fa-check"></i>More Resources</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="03-overlaypoints.html"><a href="03-overlaypoints.html"><i class="fa fa-check"></i><b>3</b> Adding Resources</a><ul>
<li class="chapter" data-level="3.1" data-path="03-overlaypoints.html"><a href="03-overlaypoints.html#geocode"><i class="fa fa-check"></i><b>3.1</b> Geocode</a></li>
<li class="chapter" data-level="3.2" data-path="03-overlaypoints.html"><a href="03-overlaypoints.html#convert-to-spatial-data"><i class="fa fa-check"></i><b>3.2</b> Convert to Spatial Data</a></li>
<li class="chapter" data-level="3.3" data-path="03-overlaypoints.html"><a href="03-overlaypoints.html#basic-map-of-points"><i class="fa fa-check"></i><b>3.3</b> Basic Map of Points</a></li>
<li class="chapter" data-level="3.4" data-path="03-overlaypoints.html"><a href="03-overlaypoints.html#overlay-points-style"><i class="fa fa-check"></i><b>3.4</b> Overlay Points &amp; Style</a></li>
<li class="chapter" data-level="3.5" data-path="03-overlaypoints.html"><a href="03-overlaypoints.html#integrate-more-data-1"><i class="fa fa-check"></i><b>3.5</b> Integrate More Data</a></li>
<li class="chapter" data-level="3.6" data-path="03-overlaypoints.html"><a href="03-overlaypoints.html#graduated-symbology"><i class="fa fa-check"></i><b>3.6</b> Graduated Symbology</a></li>
<li class="chapter" data-level="3.7" data-path="03-overlaypoints.html"><a href="03-overlaypoints.html#style-final-map"><i class="fa fa-check"></i><b>3.7</b> Style Final Map</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="04-newsvar.html"><a href="04-newsvar.html"><i class="fa fa-check"></i><b>4</b> Calculate Spatial Metrics</a><ul>
<li class="chapter" data-level="4.1" data-path="04-newsvar.html"><a href="04-newsvar.html#load-spatial-data-1"><i class="fa fa-check"></i><b>4.1</b> Load Spatial Data</a></li>
<li class="chapter" data-level="4.2" data-path="04-newsvar.html"><a href="04-newsvar.html#project-data"><i class="fa fa-check"></i><b>4.2</b> Project Data</a></li>
<li class="chapter" data-level="4.3" data-path="04-newsvar.html"><a href="04-newsvar.html#count-resources-by-area"><i class="fa fa-check"></i><b>4.3</b> Count resources by area</a><ul>
<li class="chapter" data-level="4.3.1" data-path="04-newsvar.html"><a href="04-newsvar.html#count-per-area"><i class="fa fa-check"></i><b>4.3.1</b> Count # per Area</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="04-newsvar.html"><a href="04-newsvar.html#buffer-data"><i class="fa fa-check"></i><b>4.4</b> Buffer Data</a></li>
<li class="chapter" data-level="4.5" data-path="04-newsvar.html"><a href="04-newsvar.html#count-buffers-by-area"><i class="fa fa-check"></i><b>4.5</b> Count buffers by area</a></li>
<li class="chapter" data-level="4.6" data-path="04-newsvar.html"><a href="04-newsvar.html#integrate-explore"><i class="fa fa-check"></i><b>4.6</b> Integrate &amp; Explore</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Intro to R-Spatial for Healthy Places</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="calculate-spatial-metrics" class="section level1">
<h1><span class="header-section-number">4</span> Calculate Spatial Metrics</h1>
<p>While we’ve generated some nice visualizations, we need insights quantified as metrics at the neighborhood level. Don’t start this step until you have a good idea of what you need. Visualizing and exploring the data in depth is best practice.</p>
<p>For our purposes, we’re interested in developing spatial access metrics with a container method approach. At the end of this tutorial, we’ll generate the following new variables:</p>
<ul>
<li>Total number of Methadone Maintenance MOUD by zip code</li>
<li>Total number of Walkble MOUD Service Areas by zip code</li>
</ul>
<p>Plus, we will have a new spatial layer, that includes the actual service areas (ie. 1-mile buffers of MOUDs). We assume that access to MOUDs is critical and requires high regularity, and that walking is the most likely option during COVID. This guides the parameter specification of MOUD Service Areas (and is also backed up by some literature in this space, though much more is needed.)</p>
<div id="load-spatial-data-1" class="section level2">
<h2><span class="header-section-number">4.1</span> Load Spatial Data</h2>
<p>Let’s first reload our spatial data – this will be the MOUD points, plus the master zip code spatial file.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(sf)</a></code></pre></div>
<pre><code>## Warning: package &#39;sf&#39; was built under R version 3.6.2</code></pre>
<pre><code>## Linking to GEOS 3.7.2, GDAL 2.4.2, PROJ 5.2.0</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">points &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&quot;data/methadoneMOUD1.geojson&quot;</span>)</a></code></pre></div>
<pre><code>## Reading layer `methadoneMOUD1&#39; from data source 
##   `/Users/maryniakolak/code/Intro2RSpatialMed/data/methadoneMOUD1.geojson&#39; 
##   using driver `GeoJSON&#39;
## Simple feature collection with 25 features and 8 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -87.7349 ymin: 41.68698 xmax: -87.57673 ymax: 41.9533
## CRS:           4326</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">areas &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&quot;data/ChiZipMaster1.geojson&quot;</span>)</a></code></pre></div>
<pre><code>## Reading layer `ChiZipMaster1&#39; from data source 
##   `/Users/maryniakolak/code/Intro2RSpatialMed/data/ChiZipMaster1.geojson&#39; 
##   using driver `GeoJSON&#39;
## Simple feature collection with 540 features and 31 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -87.87596 ymin: 41.64454 xmax: -87.52414 ymax: 42.02304
## CRS:           4326</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">head</span>(points)</a></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 8 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: -87.72186 ymin: 41.88474 xmax: -87.63409 ymax: 41.9533
## CRS:           4326
##   X                                                         Name
## 1 3 Soft Landing Interventions/DBA Symetria Recovery of Lakeview
## 2 4                                        PDSSC - Chicago, Inc.
## 3 5                          Center for Addictive Problems, Inc.
## 4 6                                Family Guidance Centers, Inc.
## 5 7                                     A Rincon Family Services
## 6 8                                                            *
##                Address    City State   Zip
## 1 3934 N. Lincoln Ave. Chicago    IL 60613
## 2  2260 N. Elston Ave. Chicago    IL 60614
## 3     609 N. Wells St. Chicago    IL 60654
## 4  310 W. Chicago Ave. Chicago    IL 60654
## 5   3809 W. Grand Ave. Chicago    IL 60651
## 6  140 N. Ashland Ave. Chicago    IL 60607
##                                 fullAdd geo_method                   geometry
## 1 3934 N. Lincoln Ave. Chicago IL 60613     census  POINT (-87.67818 41.9533)
## 2  2260 N. Elston Ave. Chicago IL 60614     census POINT (-87.67407 41.92269)
## 3     609 N. Wells St. Chicago IL 60654     census POINT (-87.63409 41.89268)
## 4  310 W. Chicago Ave. Chicago IL 60654     census POINT (-87.63636 41.89657)
## 5   3809 W. Grand Ave. Chicago IL 60651     census POINT (-87.72186 41.90435)
## 6  140 N. Ashland Ave. Chicago IL 60607        osm POINT (-87.66725 41.88474)</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">head</span>(areas)</a></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 31 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -87.63999 ymin: 41.85317 xmax: -87.60246 ymax: 41.88913
## CRS:           4326
##     zip objectid shape_area shape_len Case.Rate...Cumulative year totPopE
## 1 60601       27    9166246  19804.58                 1451.4 2018   14675
## 2 60602       26    4847125  14448.17                 1688.1 2018    1244
## 3 60603       19    4560229  13672.68                 1107.3 2018    1174
## 4 60604       48    4294902  12245.81                 3964.2 2018     782
## 5 60605       20   36301276  37973.35                 1420.8 2018   27519
## 6 60606       31    6766411  12040.44                 2289.6 2018    3101
##   whiteP blackP amIndP asianP pacIsP otherP hispP noHSP age0_4 age5_14 age15_19
## 1  74.17   5.57   0.45  18.00   0.00   1.81  8.68  0.00    550     156      907
## 2  68.17   3.78   5.31  19.45   0.00   3.30  6.51  0.00     61      87       18
## 3  63.46   3.24   0.00  27.60   0.00   5.71  9.80  0.00     13      43      179
## 4  63.43   5.63   0.00  29.67   0.00   1.28  4.35  0.00     12       7       52
## 5  61.20  17.18   0.18  16.10   0.03   5.31  5.84  2.39    837    1279     2172
## 6  72.75   2.35   0.00  18.09   0.00   6.80  6.29  0.73     57      44        0
##   age20_24 age15_44 age45_49 age50_54 age55_59 age60_64 ageOv65 ageOv18
## 1      909     8726      976     1009      324      859    2075   13855
## 2       91      987       46       53        0        5       5    1095
## 3      172      684       75       47      150       50     112    1118
## 4      168      450       27       47       54       92      93     744
## 5     2282    16364     1766     1520     1824     1360    2569   25259
## 6      139     1863      213      153      168      172     431    3000
##   age18_64 a15_24P und45P ovr65P disbP                       geometry
## 1    11780   12.37  64.27  14.14   6.4 MULTIPOLYGON (((-87.62271 4...
## 2     1090    8.76  91.24   0.40   0.2 MULTIPOLYGON (((-87.60997 4...
## 3     1006   29.90  63.03   9.54   7.3 MULTIPOLYGON (((-87.61633 4...
## 4      651   28.13  59.97  11.89   4.1 MULTIPOLYGON (((-87.63376 4...
## 5    22690   16.19  67.15   9.34   5.3 MULTIPOLYGON (((-87.62064 4...
## 6     2569    4.48  63.33  13.90   1.9 MULTIPOLYGON (((-87.63397 4...</code></pre>
</div>
<div id="project-data" class="section level2">
<h2><span class="header-section-number">4.2</span> Project Data</h2>
<p>First we need to switch to a projection that uses distance in feet or meters as a metric. We’ll use EPSG:3435 from the first tutorial. To find which EPSG was recommended, I searched “EPSG Illinois feet” and EPSG:3435 came up as a viable candidate. So, we use that for our new, projected CRS.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">areas &lt;-<span class="st"> </span><span class="kw">st_transform</span>(areas, <span class="dv">3435</span>)</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">points &lt;-<span class="st"> </span><span class="kw">st_transform</span>(points, <span class="dv">3435</span>)</a></code></pre></div>
<p>We may want to once again confirm they are plotting correctly:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">library</span>(tmap)</a></code></pre></div>
<pre><code>## Warning: replacing previous import &#39;sf::st_make_valid&#39; by
## &#39;lwgeom::st_make_valid&#39; when loading &#39;tmap&#39;</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">tm_shape</span>(areas) <span class="op">+</span><span class="st"> </span><span class="kw">tm_polygons</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="st">  </span><span class="kw">tm_shape</span>(points) <span class="op">+</span><span class="st"> </span><span class="kw">tm_dots</span>(<span class="dt">size =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="Spatial-R-for-Healthy-Places_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
</div>
<div id="count-resources-by-area" class="section level2">
<h2><span class="header-section-number">4.3</span> Count resources by area</h2>
<p>One way of understanding resource inequity is by thinking about how many resources exist in a neighborhood.</p>
<p>First, give the points the attributes of the polygons they are in. Inspect.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">pip &lt;-<span class="st"> </span><span class="kw">st_join</span>(points, areas, <span class="dt">join =</span> st_within)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="kw">head</span>(pip)</a></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 39 fields
## Geometry type: POINT
## Dimension:     XY
## Bounding box:  xmin: 1162460 ymin: 1926255 xmax: 1162460 ymax: 1926255
## CRS:           EPSG:3435
##     X                                                         Name
## 1   3 Soft Landing Interventions/DBA Symetria Recovery of Lakeview
## 1.1 3 Soft Landing Interventions/DBA Symetria Recovery of Lakeview
## 1.2 3 Soft Landing Interventions/DBA Symetria Recovery of Lakeview
## 1.3 3 Soft Landing Interventions/DBA Symetria Recovery of Lakeview
## 1.4 3 Soft Landing Interventions/DBA Symetria Recovery of Lakeview
## 1.5 3 Soft Landing Interventions/DBA Symetria Recovery of Lakeview
##                  Address    City State   Zip
## 1   3934 N. Lincoln Ave. Chicago    IL 60613
## 1.1 3934 N. Lincoln Ave. Chicago    IL 60613
## 1.2 3934 N. Lincoln Ave. Chicago    IL 60613
## 1.3 3934 N. Lincoln Ave. Chicago    IL 60613
## 1.4 3934 N. Lincoln Ave. Chicago    IL 60613
## 1.5 3934 N. Lincoln Ave. Chicago    IL 60613
##                                   fullAdd geo_method   zip objectid shape_area
## 1   3934 N. Lincoln Ave. Chicago IL 60613     census 60613       53   53990895
## 1.1 3934 N. Lincoln Ave. Chicago IL 60613     census 60613       53   53990895
## 1.2 3934 N. Lincoln Ave. Chicago IL 60613     census 60613       53   53990895
## 1.3 3934 N. Lincoln Ave. Chicago IL 60613     census 60613       53   53990895
## 1.4 3934 N. Lincoln Ave. Chicago IL 60613     census 60613       53   53990895
## 1.5 3934 N. Lincoln Ave. Chicago IL 60613     census 60613       53   53990895
##     shape_len Case.Rate...Cumulative year totPopE whiteP blackP amIndP asianP
## 1    31196.32                 1572.4 2018   50113   81.9   5.79   0.41    6.6
## 1.1  31196.32                 1572.4 2018   50113   81.9   5.79   0.41    6.6
## 1.2  31196.32                 1572.4 2018   50113   81.9   5.79   0.41    6.6
## 1.3  31196.32                 1572.4 2018   50113   81.9   5.79   0.41    6.6
## 1.4  31196.32                 1572.4 2018   50113   81.9   5.79   0.41    6.6
## 1.5  31196.32                 1572.4 2018   50113   81.9   5.79   0.41    6.6
##     pacIsP otherP hispP noHSP age0_4 age5_14 age15_19 age20_24 age15_44
## 1     0.02   5.27  11.3  3.42   2555    2633      777     5875    30790
## 1.1   0.02   5.27  11.3  3.42   2555    2633      777     5875    30790
## 1.2   0.02   5.27  11.3  3.42   2555    2633      777     5875    30790
## 1.3   0.02   5.27  11.3  3.42   2555    2633      777     5875    30790
## 1.4   0.02   5.27  11.3  3.42   2555    2633      777     5875    30790
## 1.5   0.02   5.27  11.3  3.42   2555    2633      777     5875    30790
##     age45_49 age50_54 age55_59 age60_64 ageOv65 ageOv18 age18_64 a15_24P und45P
## 1       2880     2546     2412     1868    4429   44320    39891   13.27  71.79
## 1.1     2880     2546     2412     1868    4429   44320    39891   13.27  71.79
## 1.2     2880     2546     2412     1868    4429   44320    39891   13.27  71.79
## 1.3     2880     2546     2412     1868    4429   44320    39891   13.27  71.79
## 1.4     2880     2546     2412     1868    4429   44320    39891   13.27  71.79
## 1.5     2880     2546     2412     1868    4429   44320    39891   13.27  71.79
##     ovr65P disbP                geometry
## 1     8.84   7.2 POINT (1162460 1926255)
## 1.1   8.84   7.2 POINT (1162460 1926255)
## 1.2   8.84   7.2 POINT (1162460 1926255)
## 1.3   8.84   7.2 POINT (1162460 1926255)
## 1.4   8.84   7.2 POINT (1162460 1926255)
## 1.5   8.84   7.2 POINT (1162460 1926255)</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">dim</span>(pip)</a></code></pre></div>
<pre><code>## [1] 225  40</code></pre>
<div id="count-per-area" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Count # per Area</h3>
<p>Next, count the number per area.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">ptcount &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">table</span>(pip<span class="op">$</span>Zip))</a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="kw">head</span>(ptcount)</a></code></pre></div>
<pre><code>##    Var1 Freq
## 1 60607   18
## 2 60608    9
## 3 60609    9
## 4 60613    9
## 5 60614    9
## 6 60615    9</code></pre>
<p>How could improve on this step if you used <code>dplyr</code>?</p>
<p><strong>Aggregation Tip:</strong> What if you have an attribute value you’d like to aggregate? For example, average units of affordable housing facility by zip?
Try <code>aggregate(pip$attribute, by = list(pip$geoid), mean)</code> but build on with a tidy sensibility…</p>
<p>Now we can rename our attributes:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw">names</span>(ptcount) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;zip&quot;</span>, <span class="st">&quot;MetClnc&quot;</span>)</a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="kw">head</span>(ptcount)</a></code></pre></div>
<pre><code>##     zip MetClnc
## 1 60607      18
## 2 60608       9
## 3 60609       9
## 4 60613       9
## 5 60614       9
## 6 60615       9</code></pre>
<p>And finally, merge back to your master zip file:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">areas&lt;-<span class="st"> </span><span class="kw">merge</span>(areas, ptcount, <span class="dt">by=</span><span class="st">&quot;zip&quot;</span>)</a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="kw">head</span>(areas)</a></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 32 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 1165664 ymin: 1892290 xmax: 1174872 ymax: 1902906
## CRS:           EPSG:3435
##     zip objectid shape_area shape_len Case.Rate...Cumulative year totPopE
## 1 60607       29   64664294  39143.64                 2504.1 2018   29591
## 2 60607       29   64664294  39143.64                 2504.1 2018   29591
## 3 60607       29   64664294  39143.64                 2504.1 2018   29591
## 4 60607       29   64664294  39143.64                 2504.1 2018   29591
## 5 60607       29   64664294  39143.64                 2504.1 2018   29591
## 6 60607       29   64664294  39143.64                 2504.1 2018   29591
##   whiteP blackP amIndP asianP pacIsP otherP hispP noHSP age0_4 age5_14 age15_19
## 1  58.17  14.51   0.13  22.58    0.1   4.51   8.3  3.94   1660    1392     2351
## 2  58.17  14.51   0.13  22.58    0.1   4.51   8.3  3.94   1660    1392     2351
## 3  58.17  14.51   0.13  22.58    0.1   4.51   8.3  3.94   1660    1392     2351
## 4  58.17  14.51   0.13  22.58    0.1   4.51   8.3  3.94   1660    1392     2351
## 5  58.17  14.51   0.13  22.58    0.1   4.51   8.3  3.94   1660    1392     2351
## 6  58.17  14.51   0.13  22.58    0.1   4.51   8.3  3.94   1660    1392     2351
##   age20_24 age15_44 age45_49 age50_54 age55_59 age60_64 ageOv65 ageOv18
## 1     4588    20860     1392      859     1122      702    1604   26241
## 2     4588    20860     1392      859     1122      702    1604   26241
## 3     4588    20860     1392      859     1122      702    1604   26241
## 4     4588    20860     1392      859     1122      702    1604   26241
## 5     4588    20860     1392      859     1122      702    1604   26241
## 6     4588    20860     1392      859     1122      702    1604   26241
##   age18_64 a15_24P und45P ovr65P disbP MetClnc                       geometry
## 1    24637   23.45  80.81   5.42   6.1      18 MULTIPOLYGON (((1173173 189...
## 2    24637   23.45  80.81   5.42   6.1      18 MULTIPOLYGON (((1173173 189...
## 3    24637   23.45  80.81   5.42   6.1      18 MULTIPOLYGON (((1173173 189...
## 4    24637   23.45  80.81   5.42   6.1      18 MULTIPOLYGON (((1173173 189...
## 5    24637   23.45  80.81   5.42   6.1      18 MULTIPOLYGON (((1173173 189...
## 6    24637   23.45  80.81   5.42   6.1      18 MULTIPOLYGON (((1173173 189...</code></pre>
<p>Quickly map to inspect:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw">tm_shape</span>(areas) <span class="op">+</span><span class="st"> </span><span class="kw">tm_polygons</span>(<span class="dt">col =</span> <span class="st">&quot;gray90&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="kw">tm_shape</span>(areas) <span class="op">+</span><span class="st"> </span><span class="kw">tm_fill</span>(<span class="dt">col =</span> <span class="st">&quot;MetClnc&quot;</span>, <span class="dt">style =</span> <span class="st">&quot;jenks&quot;</span>, <span class="dt">alpha =</span> <span class="fl">0.2</span>) <span class="op">+</span><span class="st">   </span></a>
<a class="sourceLine" id="cb27-3" data-line-number="3"><span class="st">  </span><span class="kw">tm_shape</span>(points) <span class="op">+</span><span class="st"> </span><span class="kw">tm_dots</span>() </a></code></pre></div>
<p><img src="Spatial-R-for-Healthy-Places_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
</div>
<div id="buffer-data" class="section level2">
<h2><span class="header-section-number">4.4</span> Buffer Data</h2>
<p>Next, lets create a walkable buffer of one mile, or 5280 feet, for our MOUD provider locations. Individuals residing in places outside of that walkabile area may have difficulty accessing this medication during crises, like a pandemic.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="co"># Create 1mile buffers for each point</span></a>
<a class="sourceLine" id="cb28-2" data-line-number="2">ptbuffers &lt;-<span class="st"> </span><span class="kw">st_buffer</span>(points, <span class="dv">5280</span>)</a></code></pre></div>
<p>Inspect immediately:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"><span class="kw">tm_shape</span>(areas) <span class="op">+</span><span class="st"> </span><span class="kw">tm_borders</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="st">  </span><span class="kw">tm_shape</span>(ptbuffers) <span class="op">+</span><span class="st"> </span><span class="kw">tm_borders</span>(<span class="dt">col =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb29-3" data-line-number="3"><span class="st">  </span><span class="kw">tm_shape</span>(points) <span class="op">+</span><span class="st"> </span><span class="kw">tm_dots</span>(<span class="dt">col =</span> <span class="st">&quot;red&quot;</span>) </a></code></pre></div>
<p><img src="Spatial-R-for-Healthy-Places_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
</div>
<div id="count-buffers-by-area" class="section level2">
<h2><span class="header-section-number">4.5</span> Count buffers by area</h2>
<p>We know that MOUD locations are accessible up to one mile away. So a total number of resources by area may be too restrictive. Let’s calculated how many walkable service areas of MOUD clinics are in each tract. Or, how many buffers are in each tract…</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">bufferct &lt;-<span class="st"> </span><span class="kw">lengths</span>(<span class="kw">st_within</span>(areas, ptbuffers))</a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="kw">head</span>(bufferct)</a></code></pre></div>
<pre><code>## [1] 0 0 0 0 0 0</code></pre>
<p>Stick buffer totals back to the zip master file:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="co"># Stick buffer totals back to the census master file</span></a>
<a class="sourceLine" id="cb32-2" data-line-number="2">areas &lt;-<span class="st"> </span><span class="kw">cbind</span>(areas,bufferct)</a>
<a class="sourceLine" id="cb32-3" data-line-number="3"><span class="kw">head</span>(areas)</a></code></pre></div>
<pre><code>## Simple feature collection with 6 features and 33 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 1165664 ymin: 1892290 xmax: 1174872 ymax: 1902906
## CRS:           EPSG:3435
##     zip objectid shape_area shape_len Case.Rate...Cumulative year totPopE
## 1 60607       29   64664294  39143.64                 2504.1 2018   29591
## 2 60607       29   64664294  39143.64                 2504.1 2018   29591
## 3 60607       29   64664294  39143.64                 2504.1 2018   29591
## 4 60607       29   64664294  39143.64                 2504.1 2018   29591
## 5 60607       29   64664294  39143.64                 2504.1 2018   29591
## 6 60607       29   64664294  39143.64                 2504.1 2018   29591
##   whiteP blackP amIndP asianP pacIsP otherP hispP noHSP age0_4 age5_14 age15_19
## 1  58.17  14.51   0.13  22.58    0.1   4.51   8.3  3.94   1660    1392     2351
## 2  58.17  14.51   0.13  22.58    0.1   4.51   8.3  3.94   1660    1392     2351
## 3  58.17  14.51   0.13  22.58    0.1   4.51   8.3  3.94   1660    1392     2351
## 4  58.17  14.51   0.13  22.58    0.1   4.51   8.3  3.94   1660    1392     2351
## 5  58.17  14.51   0.13  22.58    0.1   4.51   8.3  3.94   1660    1392     2351
## 6  58.17  14.51   0.13  22.58    0.1   4.51   8.3  3.94   1660    1392     2351
##   age20_24 age15_44 age45_49 age50_54 age55_59 age60_64 ageOv65 ageOv18
## 1     4588    20860     1392      859     1122      702    1604   26241
## 2     4588    20860     1392      859     1122      702    1604   26241
## 3     4588    20860     1392      859     1122      702    1604   26241
## 4     4588    20860     1392      859     1122      702    1604   26241
## 5     4588    20860     1392      859     1122      702    1604   26241
## 6     4588    20860     1392      859     1122      702    1604   26241
##   age18_64 a15_24P und45P ovr65P disbP MetClnc bufferct
## 1    24637   23.45  80.81   5.42   6.1      18        0
## 2    24637   23.45  80.81   5.42   6.1      18        0
## 3    24637   23.45  80.81   5.42   6.1      18        0
## 4    24637   23.45  80.81   5.42   6.1      18        0
## 5    24637   23.45  80.81   5.42   6.1      18        0
## 6    24637   23.45  80.81   5.42   6.1      18        0
##                         geometry
## 1 MULTIPOLYGON (((1173173 189...
## 2 MULTIPOLYGON (((1173173 189...
## 3 MULTIPOLYGON (((1173173 189...
## 4 MULTIPOLYGON (((1173173 189...
## 5 MULTIPOLYGON (((1173173 189...
## 6 MULTIPOLYGON (((1173173 189...</code></pre>
<p>Map density of buffers per census area:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="kw">tm_shape</span>(areas) <span class="op">+</span><span class="st"> </span><span class="kw">tm_fill</span>(<span class="dt">col =</span> <span class="st">&quot;bufferct&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;BuGn&quot;</span>, <span class="dt">style =</span> <span class="st">&quot;quantile&quot;</span>,<span class="dt">title =</span> <span class="st">&quot;Housing Density&quot;</span>)</a></code></pre></div>
<p><img src="Spatial-R-for-Healthy-Places_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
<div id="integrate-explore" class="section level2">
<h2><span class="header-section-number">4.6</span> Integrate &amp; Explore</h2>
<p>Let’s review: our master area file now has total number resources by zip and total number of walkable service areas by zip.</p>
<p>Using your new spatial file, see if you can answer some of these quetions using various queries:</p>
<ul>
<li><p>Which zip codes have high rates of COVID and are not within a walking distance of a methadone MOUD?</p></li>
<li><p>Which zip codes have worse access to affordable rental units, low educational rates, and less walkable access to MOUDs?</p></li>
<li><p>What is the demographic and racial/ethnic characteristics of areas most vulnerable to high COVID rates in September 2020?</p></li>
</ul>
<p>Generate different maps and outputs to drive your thinking and defend your hypothesis formation.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="03-overlaypoints.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
