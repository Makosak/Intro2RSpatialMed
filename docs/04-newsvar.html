<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Calculate Spatial Metrics | Intro to R-Spatial for Healthy Places</title>
  <meta name="description" content="This was developed for a workshop at the 2021 R-Medicine Conference by the Health Regions &amp; Policies Lab at the University of Chicago ." />
  <meta name="generator" content="bookdown 0.16 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Calculate Spatial Metrics | Intro to R-Spatial for Healthy Places" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This was developed for a workshop at the 2021 R-Medicine Conference by the Health Regions &amp; Policies Lab at the University of Chicago ." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Calculate Spatial Metrics | Intro to R-Spatial for Healthy Places" />
  
  <meta name="twitter:description" content="This was developed for a workshop at the 2021 R-Medicine Conference by the Health Regions &amp; Policies Lab at the University of Chicago ." />
  

<meta name="author" content="Marynia Kolak" />


<meta name="date" content="2021-08-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="03-overlaypoints.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.3/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.3/leaflet-providers-plugin.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  { background-color: #f8f8f8; }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Background</a></li>
<li class="chapter" data-level="1" data-path="01-intro.html"><a href="01-intro.html"><i class="fa fa-check"></i><b>1</b> Intro to Spatial Data</a><ul>
<li class="chapter" data-level="1.1" data-path="01-intro.html"><a href="01-intro.html#load-spatial-data"><i class="fa fa-check"></i><b>1.1</b> Load Spatial Data</a></li>
<li class="chapter" data-level="1.2" data-path="01-intro.html"><a href="01-intro.html#non-spatial-spatial-views"><i class="fa fa-check"></i><b>1.2</b> Non-Spatial &amp; Spatial Views</a></li>
<li class="chapter" data-level="1.3" data-path="01-intro.html"><a href="01-intro.html#spatial-data-structure"><i class="fa fa-check"></i><b>1.3</b> Spatial Data Structure</a></li>
<li class="chapter" data-level="1.4" data-path="01-intro.html"><a href="01-intro.html#exploring-coordinate-reference-systems"><i class="fa fa-check"></i><b>1.4</b> Exploring Coordinate Reference Systems</a></li>
<li class="chapter" data-level="1.5" data-path="01-intro.html"><a href="01-intro.html#refine-basic-map"><i class="fa fa-check"></i><b>1.5</b> Refine Basic Map</a></li>
<li class="chapter" data-level="1.6" data-path="01-intro.html"><a href="01-intro.html#arrange-multiple-maps"><i class="fa fa-check"></i><b>1.6</b> Arrange multiple maps</a></li>
<li class="chapter" data-level="1.7" data-path="01-intro.html"><a href="01-intro.html#interactive-mode"><i class="fa fa-check"></i><b>1.7</b> Interactive Mode</a></li>
<li class="chapter" data-level="1.8" data-path="01-intro.html"><a href="01-intro.html#overlay-zip-code-boundaries"><i class="fa fa-check"></i><b>1.8</b> Overlay Zip Code Boundaries</a></li>
<li class="chapter" data-level="" data-path="01-intro.html"><a href="01-intro.html#more-resources"><i class="fa fa-check"></i>More Resources</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="02-choropleth.html"><a href="02-choropleth.html"><i class="fa fa-check"></i><b>2</b> Map Neighborhoods</a><ul>
<li class="chapter" data-level="2.1" data-path="02-choropleth.html"><a href="02-choropleth.html#clean-attribute-data"><i class="fa fa-check"></i><b>2.1</b> Clean Attribute Data</a></li>
<li class="chapter" data-level="2.2" data-path="02-choropleth.html"><a href="02-choropleth.html#merge-spatial-data"><i class="fa fa-check"></i><b>2.2</b> Merge Spatial Data</a></li>
<li class="chapter" data-level="2.3" data-path="02-choropleth.html"><a href="02-choropleth.html#quantile-maps"><i class="fa fa-check"></i><b>2.3</b> Quantile Maps</a></li>
<li class="chapter" data-level="2.4" data-path="02-choropleth.html"><a href="02-choropleth.html#standard-deviation-maps"><i class="fa fa-check"></i><b>2.4</b> Standard Deviation Maps</a></li>
<li class="chapter" data-level="2.5" data-path="02-choropleth.html"><a href="02-choropleth.html#jenks-maps"><i class="fa fa-check"></i><b>2.5</b> Jenks Maps</a></li>
<li class="chapter" data-level="2.6" data-path="02-choropleth.html"><a href="02-choropleth.html#integrate-more-data"><i class="fa fa-check"></i><b>2.6</b> Integrate More Data</a></li>
<li class="chapter" data-level="2.7" data-path="02-choropleth.html"><a href="02-choropleth.html#thematic-map-panel"><i class="fa fa-check"></i><b>2.7</b> Thematic Map Panel</a></li>
<li class="chapter" data-level="2.8" data-path="02-choropleth.html"><a href="02-choropleth.html#write-data"><i class="fa fa-check"></i><b>2.8</b> Write Data</a></li>
<li class="chapter" data-level="" data-path="02-choropleth.html"><a href="02-choropleth.html#more-resources-1"><i class="fa fa-check"></i>More Resources</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="03-overlaypoints.html"><a href="03-overlaypoints.html"><i class="fa fa-check"></i><b>3</b> Adding Resources</a><ul>
<li class="chapter" data-level="3.1" data-path="03-overlaypoints.html"><a href="03-overlaypoints.html#geocode"><i class="fa fa-check"></i><b>3.1</b> Geocode</a></li>
<li class="chapter" data-level="3.2" data-path="03-overlaypoints.html"><a href="03-overlaypoints.html#convert-to-spatial-data"><i class="fa fa-check"></i><b>3.2</b> Convert to Spatial Data</a></li>
<li class="chapter" data-level="3.3" data-path="03-overlaypoints.html"><a href="03-overlaypoints.html#basic-map-of-points"><i class="fa fa-check"></i><b>3.3</b> Basic Map of Points</a></li>
<li class="chapter" data-level="3.4" data-path="03-overlaypoints.html"><a href="03-overlaypoints.html#overlay-points-style"><i class="fa fa-check"></i><b>3.4</b> Overlay Points &amp; Style</a></li>
<li class="chapter" data-level="3.5" data-path="03-overlaypoints.html"><a href="03-overlaypoints.html#integrate-more-data-1"><i class="fa fa-check"></i><b>3.5</b> Integrate More Data</a></li>
<li class="chapter" data-level="3.6" data-path="03-overlaypoints.html"><a href="03-overlaypoints.html#graduated-symbology"><i class="fa fa-check"></i><b>3.6</b> Graduated Symbology</a></li>
<li class="chapter" data-level="3.7" data-path="03-overlaypoints.html"><a href="03-overlaypoints.html#style-final-map"><i class="fa fa-check"></i><b>3.7</b> Style Final Map</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="04-newsvar.html"><a href="04-newsvar.html"><i class="fa fa-check"></i><b>4</b> Calculate Spatial Metrics</a><ul>
<li class="chapter" data-level="4.1" data-path="04-newsvar.html"><a href="04-newsvar.html#project-data"><i class="fa fa-check"></i><b>4.1</b> Project Data</a></li>
<li class="chapter" data-level="4.2" data-path="04-newsvar.html"><a href="04-newsvar.html#buffer-data"><i class="fa fa-check"></i><b>4.2</b> Buffer Data</a></li>
<li class="chapter" data-level="4.3" data-path="04-newsvar.html"><a href="04-newsvar.html#count-resources-by-area"><i class="fa fa-check"></i><b>4.3</b> Count resources by area</a></li>
<li class="chapter" data-level="4.4" data-path="04-newsvar.html"><a href="04-newsvar.html#count-buffers-by-area"><i class="fa fa-check"></i><b>4.4</b> Count buffers by area</a></li>
<li class="chapter" data-level="4.5" data-path="04-newsvar.html"><a href="04-newsvar.html#integrate-explore"><i class="fa fa-check"></i><b>4.5</b> Integrate &amp; Explore</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Intro to R-Spatial for Healthy Places</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="calculate-spatial-metrics" class="section level1">
<h1><span class="header-section-number">4</span> Calculate Spatial Metrics</h1>
<p>While we’ve generated some nice visualizations, we may need insights quantified as metrics at the neighborhood level.</p>
<div id="project-data" class="section level2">
<h2><span class="header-section-number">4.1</span> Project Data</h2>
<p>First we need to switch to a projection that uses distance in feet or meters as a metric. Google search with the terms “EPSG”, your place of interest, and “feet.” For example, I searched “EPSG Illinois feet” and EPSG:3435 came up as a viable candidate. I’ll use that for our new, projected CRS.</p>
</div>
<div id="buffer-data" class="section level2">
<h2><span class="header-section-number">4.2</span> Buffer Data</h2>
<p>Next, lets create a walkable buffer of one mile, or XX feet, for our MOUD provider locations. Individuals residing in places outside of that walkabile area may have difficulty accessing this medication during crises, like a pandemic.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" data-line-number="1"><span class="kw">library</span>(sf)</a>
<a class="sourceLine" id="cb90-2" data-line-number="2"></a>
<a class="sourceLine" id="cb90-3" data-line-number="3"><span class="co"># Load MOUD point data</span></a>
<a class="sourceLine" id="cb90-4" data-line-number="4"></a>
<a class="sourceLine" id="cb90-5" data-line-number="5"><span class="co"># Generate a buffer of one mile</span></a></code></pre></div>
<p>Now we can map the buffers:</p>
</div>
<div id="count-resources-by-area" class="section level2">
<h2><span class="header-section-number">4.3</span> Count resources by area</h2>
<p>Another way of understanding resource inequity is by thinking about how many resources exist in a neighborhood. If we didn’t have zip code areas in our location dataset, we could add them using a spatial join.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" data-line-number="1"><span class="co"># Load zip codes</span></a>
<a class="sourceLine" id="cb91-2" data-line-number="2"></a>
<a class="sourceLine" id="cb91-3" data-line-number="3"><span class="co"># Spatially join points to areas</span></a>
<a class="sourceLine" id="cb91-4" data-line-number="4"></a>
<a class="sourceLine" id="cb91-5" data-line-number="5"><span class="co"># Count how many points are in each area</span></a></code></pre></div>
<p>Is there a more “tidy” way to do that last step? Explore…</p>
<p>Furthermore – you can reuse the coding snippet for different types of areas. For example, how many resources exist in each census tract, or block group? Etc. Another way to use this code is to spatially join individual patient locations to tracts… Once you have coordinates for each location, you’d convert to spatial data, and then use <code>sf</code> to spatially join.</p>
</div>
<div id="count-buffers-by-area" class="section level2">
<h2><span class="header-section-number">4.4</span> Count buffers by area</h2>
<p>As the first stage already showed us, we know that MOUD locations are accessible up to one mile away. So a total number of resources by area may be too restrictive. Let’s calculated how many walkable service areas of MOUD clinics are in each tract. Or, how many buffers are in each tract…</p>
</div>
<div id="integrate-explore" class="section level2">
<h2><span class="header-section-number">4.5</span> Integrate &amp; Explore</h2>
<p>Let’s review: our master area file now has total number resources by zip and total number of walkable service areas by zip.</p>
<p>Using your new spatial file, see if you can answer some of these quetions using various queries:</p>
<ul>
<li><p>Which zip codes have high rates of COVID and are not within a walking distance of a methadone MOUD?</p></li>
<li><p>Which zip codes have worse access to affordable rental units, low educational rates, and less walkable access to MOUDs?</p></li>
<li><p>What is the demographic and racial/ethnic characteristics of areas most vulnerable to high COVID rates in September 2020?</p></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="03-overlaypoints.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
